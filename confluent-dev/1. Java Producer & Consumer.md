# Producer dan Consumer menggunakan Java

## Buat Producer Menggunakan Java

Pertama, download Java dan Apache Maven pada sistem. Apache Maven yang akan membuat project dan file .jar. Setelah itu, buat project Maven baru dengan command berikut:

```
mvn archetype:generate -DgroupId=com.example -DartifactId=kafka-producer-consumer -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false
```

Setelah project dibuat, akan ada file `pom.xml`. Buka file tersebut dan tambahkan dependency Kafka client library di bagian `<dependencies>`

```
 <dependency>
    <groupId>org.apache.kafka</groupId>
    <artifactId>kafka-clients</artifactId>
    <version>3.5.1</version>
</dependency>
```

Buat file baru Producer.java di folder `src/main/java/com/example/` dan tambahkan kode berikut:

```
package com.example;

import org.apache.kafka.clients.producer.*;
import org.apache.kafka.common.serialization.StringSerializer;
import java.util.Properties;

public class ProducerExample {
    public static void main(String[] args) {
        String bootstrapServers = "10.100.13.149:9092";
        String topic = "test_topic";

        // Producer properties
        Properties properties = new Properties();
        properties.setProperty(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);
        properties.setProperty(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());
        properties.setProperty(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());

        // Create the producer
        KafkaProducer<String, String> producer = new KafkaProducer<>(properties);

        // Send data
        ProducerRecord<String, String> record = new ProducerRecord<>(topic, "key", "Hello Kafka!");
        producer.send(record, (metadata, exception) -> {
            if (exception == null) {
                System.out.println("Sent message with offset: " + metadata.offset());
            } else {
                exception.printStackTrace();
            }
        });

        // Flush and close producer
        producer.flush();
        producer.close();
    }
}
```

Pada folder yang sama, buat Consumer.java yang isinya:

```
package com.example;

import org.apache.kafka.clients.consumer.*;
import org.apache.kafka.common.serialization.StringDeserializer;
import java.time.Duration;
import java.util.Collections;
import java.util.Properties;

public class ConsumerExample {
    public static void main(String[] args) {
        String bootstrapServers = "10.100.13.149:9092";
        String groupId = "test-group";
        String topic = "test_topic";

        // Consumer properties
        Properties properties = new Properties();
        properties.setProperty(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);
        properties.setProperty(ConsumerConfig.GROUP_ID_CONFIG, groupId);
        properties.setProperty(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());
        properties.setProperty(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());
        properties.setProperty(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest");

        // Create the consumer
        KafkaConsumer<String, String> consumer = new KafkaConsumer<>(properties);

        // Subscribe to the topic
        consumer.subscribe(Collections.singleton(topic));

        // Poll for new data
        while (true) {
            ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));
            for (ConsumerRecord<String, String> record : records) {
                System.out.println("Received message: " + record.value() + ", Offset: " + record.offset());
            }
        }
    }
}
```

Tambahkan konfigurasi berikut ke pom.xml:

```
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-shade-plugin</artifactId>
            <version>3.2.4</version>
            <executions>
                <execution>
                    <phase>package</phase>
                    <goals>
                        <goal>shade</goal>
                    </goals>
                    <configuration>
                        <outputFile>${project.build.directory}/${project.artifactId}-${project.version}-shaded.jar</outputFile>
                        <transformers>
                            <transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
                                <mainClass>com.example.ProducerExample</mainClass>
                            </transformer>
                        </transformers>
                    </configuration>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

Jalankan command berikut. Ini akan membuat file .jar bernama kafka-producer-consumer-1.0-SNAPSHOT.jar.

```
mvn clean package
```

Untuk menjalankan file .jar producer dan consumer, gunakan perintah berikut:

```
java -cp target/kafka-producer-consumer-1.0-SNAPSHOT-shaded.jar com.example.Producer
```

![image](https://github.com/user-attachments/assets/9f51268d-2416-44c0-bda5-7c8ba44f7c70)


```
java -cp target/kafka-producer-consumer-1.0-SNAPSHOT-shaded.jar com.example.Consumer
```

![image](https://github.com/user-attachments/assets/e47366b6-1f17-4308-9521-b4d5ec58cf03)

