# Install Confluent Platform

![image](https://github.com/user-attachments/assets/d1124703-f1c5-4e99-a056-b4e954d440ff)

Gambar ini menggambarkan komponen-komponen Confluent Platform, yang dapat diinstal di satu atau beberapa mesin. Dalam pengembangan, semua komponen sering dijalankan di satu mesin, sedangkan dalam produksi, tiap komponen biasanya berjalan di klusternya masing-masing.

Menginstal Confluent Platform melalui arsip TAR membuat pengaturan di environment pengembangan lokal menjadi lebih cepat, sedangkan manajer paket seperti _apt_ dan _yum_ adalah cara paling andal untuk menginstal server kelas produksi dengan memudahkan update dan secara otomatis menangani banyak konfigurasi sistem, seperti pengaturan layanan systemd dan peningkatan batas file handle yang terbuka.

## Install via Tarball

Untuk menginstall Confluent Platform dengan instalasi tarball, buka lab environment dan jalankan command berikut:

```
sudo apt-get install openjdk-11-jre-headless
```

Download dan extract archive TAR Confluent Platform 7.1.1:

```
curl -O http://packages.confluent.io/archive/7.1/confluent-7.1.1.tar.gz
tar xzf confluent-7.1.1.tar.gz
```

![image](https://github.com/user-attachments/assets/81b684ad-074d-46e3-9f9d-708ab8b3b065)

### Konfigurasi CLI Confluent

Set variabel CONFLUENT_HOME ke lokasi instalasi dan tambahkan ke .bashrc.

```
export CONFLUENT_HOME=${HOME}/confluent-7.1.1 \
    && echo "export CONFLUENT_HOME=$CONFLUENT_HOME" >> ~/.bashrc
```

Tambahkan binary Confluent Platform (yang mencakup Confluent CLI) ke variabel PATH.

```
echo "export PATH=$CONFLUENT_HOME/bin:${PATH}" >> ~/.bashrc
```

Aktifkan Bash completion untuk CLI yang menyatu dan sumberkan .bashrc agar semua perubahan berlaku:

```
~/confluent-7.1.1/bin/confluent completion bash | sudo tee /etc/bash_completion.d/confluent \
    && echo "source /etc/bash_completion.d/confluent" >> ~/.bashrc \
    && source ~/.bashrc
```

Sekarang CLI konfluen tersedia di PATH dan memiliki pelengkapan otomatis Tab. 

## Install via Package Manager

Saat menginstal Confluent Platform dengan manajer paket, instalasi tersebut memuat file unit ke dalam systemd, yang berarti manajemen siklus hidup setiap service bisa dibantu dengan systemctl.

Jalankan command berikut untuk menginstal java 11:

```
sudo apt-get install openjdk-11-jre-headless
```

Tambahkan kunci repositori apt Confluent ke kunci apt sistem:

```
wget -qO - https://packages.confluent.io/deb/7.1/archive.key | sudo apt-key add -
```

Tambahkan repositori apt Confluent ke sumber sistem, dan perbarui file indeks paket:

```
sudo add-apt-repository \
    "deb [arch=amd64] https://packages.confluent.io/deb/7.1 stable main" && \
    sudo apt-get update
```

Instal Confluent Platform, termasuk fitur keamanan Confluent Server:

```
sudo apt-get install -y \
    confluent-platform \
    confluent-security
```

Instal Confluent Platform, termasuk fitur keamanan Confluent Server yang ditingkatkan:

```
sudo apt-get install -y \
    confluent-platform \
    confluent-security
```

Jalankan service confluent platform menggunakan systemctl:

```
sudo systemctl start \
    confluent-server
    confluent-zookeeper \
    confluent-kafka-connect \
    confluent-ksqldb \
    confluent-kafka-rest
```

![image](https://github.com/user-attachments/assets/5d0aa3ab-9f5c-4396-8677-b9ee92265480)

## Produce dan Consume Avro Data

Jalankan Service Confluent Platform:

```
confluent local services start
```

![image](https://github.com/user-attachments/assets/ac87e0bb-b031-4df7-9c6f-d5f2bd5928df)

Buat file avro bernama temperature_reading untuk menyimpan nama kota dan value temperature dalam Fahrenheit.

```
cat <<EOF > ~/temperature_reading.avsc
{
 "namespace": "io.confluent.examples",
 "type": "record",
 "name": "temperature_reading",
 "fields": [
    {"name": "city", "type": "string"},
    {"name": "temp", "type": "int", "doc": "temperature in Fahrenheit"} ]
}
EOF
```

Buka 2 terminal. Pada salah satu terminal tersebut, jalankan consumer untuk consume topic bawaan dari lab environment, yaitu `temperatures`. Gunakan String Deserializer untuk membaca avro yang telah dibuat sebelumnya:

```
confluent local services \
    kafka consume temperatures \
    --property print.key=true \
    --property key.deserializer=org.apache.kafka.common.serialization.StringDeserializer \
    --value-format avro
```

Pada terminal yang satu lagi, jalankan producer. Gunakan 'koma' sebagai separator field dan String Serializer untuk mengirim message supaya mengikuti schema avro sebelumnya:

```
confluent local services \
    kafka produce temperatures \
    --property parse.key=true --property key.separator=, \
    --property key.serializer=org.apache.kafka.common.serialization.StringSerializer \
    --value-format avro \
    --property value.schema.file=$HOME/temperature_reading.avsc
```

Masukkan beberapa line message untuk topik:

```
alameda,{"city":"alameda","temp":58}
ashland,{"city":"ashland","temp":62}
nairobi,{"city":"nairobi","temp":65}
sydney,{"city":"sydney","temp":75}
```

![image](https://github.com/user-attachments/assets/64225cf2-51b0-4a9c-aa9e-fb59c6e7f608)

Tampilan terminal Consumer setelah mengambil data yang diproduce:

![image](https://github.com/user-attachments/assets/d10f8ba3-ba03-4014-ab0b-9877266cabe8)

Jika memproduce message yang tidak, sesuai schema, akan muncul error:

```
sydney,{"city":"sydney","temp":"75"}
```

![image](https://github.com/user-attachments/assets/5dc6c99a-f7f0-4a17-b374-4699dc4d110d)

