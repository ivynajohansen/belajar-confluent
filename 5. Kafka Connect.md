# Kafka Connect

## 1. Install Connector

Untuk menginstall Kafka Connector, pergi ke link https://www.confluent.io/hub/ dan download connector yang diinginkan, contohnya Oracle CDC Source Connector. Untuk mencari tahu path extraction zip file, cari `connect-distributed.properties` dimana Kafka terinstalasi.

![image](https://github.com/ivynajohansen/belajar-confluent/assets/83331802/c8962881-3c10-4c14-862d-51c10ff81f68)

Lalu, extract zip file ke `/usr/share/confluent-hub-components` dan restart service kafka connect dengan:

```
sudo systemctl restart confluent-kafka-connect
```

## 2. Setup Kafka Connector untuk Source

Navigasi ke Confluent Control Center (C3), klik pilihan `Connect` di navigation bar, klik `connect-default`, dan Add Connector baru yaitu Oracle CDC Source Connector. Setelah itu isi konfigurasi berdasarkan value berikut:

```
{
  "name": "OracleCdcSourceConnectorConnector_0",
  "config": {
    "connector.class": "io.confluent.connect.oracle.cdc.OracleCdcSourceConnector",
    "value.converter": "org.apache.kafka.connect.json.JsonConverter",
    "oracle.server": "10.100.13.32",
    "oracle.port": "1521",
    "oracle.sid": "ora19",
    "oracle.username": "sys as sysdba",
    "oracle.password": "@Password123",
    "redo.log.consumer.bootstrap.servers": "worker2.k8s.alldataint.com:9092",
    "table.inclusion.regex": "ora19[.]IVYNA[.](PRODUCT)"
  }
}
```

Konfigurasi ini akan membuat database ora19 Oracle pada 10.100.13.32 dengan schema IVYNA tabel PRODUCT untuk dijadikan source.

## 3. Setup Kafka Connector untuk Sink

### a. Setup Postgres

Install Postgres di CentOS:

```
sudo yum install postgresql-server postgresql-contrib
sudo postgresql-setup initdb
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

Navigasi ke `var/lib/pgsql/data/postgresql.conf` dan uncomment line berikut:

```
listen_addresses = '*'
```

Tambahkan line berikut di pg_hba_conf:

```
host    all             all             0.0.0.0/0               md5
```

Restart postgresql

```
sudo systemctl restart postgresql
```

### b. Buat Database dan User

Akses ke CLI Postgres:

```
sudo -i -u postgres
psql
```

Buat Database dan User:

```
CREATE DATABASE postgres_sink;
CREATE USER ivyna WITH PASSWORD 'ivyna';
GRANT ALL PRIVILEGES ON DATABASE postgres_sink TO ivyna;
```

### c. Konfigurasi Kafka Connect

Gunakan JDBC Sink Connector di C3 dan konfigurasi connector berdasarkan value-value berikut:

```
```
