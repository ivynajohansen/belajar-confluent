# Configure Listeners untuk Memisahkan Cluster Traffic

## Tambahkan SASL/PLAIN Listener

### 1. Produce data

Dalam topic yang telah dibuat sebelumnya, yaitu `chat-messages`, produce message dengan `kafka-console-producer`:

```
kafka-console-producer \
    --bootstrap-server 10.100.13.149:9092 \
    --topic chat-messages
```

![image](https://github.com/ivynajohansen/belajar-confluent/assets/83331802/f253ec58-1efa-41da-9dc8-1bc8e2933f3d)

Pesan dikirim tanpa error autentikasi karena default listener adalah PLAINTEXT://:9092, yang tidak diautentikasi.

### 2. Edit server.properties

Navigasi ke `/etc/kafka/server.properties` dan edit file supaya seperti berikut:

```
listeners=PLAINTEXT://10.100.13.149:9092,SASL_PLAINTEXT://10.100.13.149:9093
sasl.enabled.mechanisms=PLAIN
listener.name.sasl_plaintext.plain.sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required \
    username="kafka" \
    password="kafka-secret" \
    user_client="client-secret";
```

Ada beberapa property konfigurasi yang dapat diatur per listener. Bentuk umumnya adalah:

```
listener.name.<name>.<mechanism>.<property>=<value>
```

Dalam skenario ini, nama listener adalah `SASL_PLAINTEXT`, jadi `sasl_plaintext` muncul setelah `listener.name`. Kemudian kita memiliki mekanisme SASL `plain`. Kemudian kita memiliki properti, yaitu `sasl.jaas.config`. Properti `sasl.jaas.config` mengirimkan class login dan kredensial ke JAAS (Java Authentication and Authorization Service).

Selanjutnya, restart confluent server supaya perubahan terimplementasi.

```
sudo systemctl restart confluent-server
```

### 3. Edit client.properties

Seperti sebelumnya, coba untuk produce message menggunakan `kafka-console-producer`, kali ini menggunakan port 9093 dimana SASL dikonfigurasi.

```
kafka-console-producer \
    --bootstrap-server 10.100.13.149:9093 \
    --topic chat-messages
```

![image](https://github.com/ivynajohansen/belajar-confluent/assets/83331802/659e10b7-bf7c-4338-84cd-c37e4ccac3cf)

Sekarang ada error karena belum setting username dan password. Buat file bername `client-properties` yang isinya:

```
sasl.mechanism = PLAIN
security.protocol = SASL_PLAINTEXT
sasl.jaas.config = org.apache.kafka.common.security.plain.PlainLoginModule required \
    username="client" \
    password="client-secret";
```

### 4. Testing

Produce message ke port 9093 menggunakan file client.properties khusus untuk mengautentikasi.

```
kafka-console-producer \
    --bootstrap-server 10.100.13.149:9093 \
    --producer.config /root/belajar-confluent/client.properties \
    --topic chat-messages
```

![image](https://github.com/ivynajohansen/belajar-confluent/assets/83331802/9a57c188-c1cc-4f14-a805-88acb0f72758)

Sekarang message bisa dikirim tanpa error.

## Tambahkan Listener antar Broker
